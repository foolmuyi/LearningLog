[toc]

# MQL5学习笔记

## 基础知识

### 学习路径
- 第一阶段：学习MQL5语言的基础语法，比如数据类型、变量、逻辑运算、条件表达式、循环表达式等
- 第二阶段：学习函数式编程，编写各种功能函数组件
- 第三阶段：将多个函数组成函数库，进行调用开发
- 第四阶段：学习结构体，面向对象编程（OOP）
- 第五阶段：开始真实的自动交易系统开发：指标开发、页面控件、智能EA等
- 第六阶段：进行业务的扩展，比如连接互联网、数据库、FTP上传、授权管理、多账户管理

### 认识MT5软件

### 外汇基础知识

#### 点差（Spread）
当前撮合交易的卖价和买价之间的差异。

#### 滑点（Slip Point）
进行买入或卖出操作时，由于发出交易请求并等待撮合交易完成时真实的交易价格会发生变动，因此订单实际完成的价格可能会和你指定的价格有所差异，这样产生的价格差就是滑点。

#### 隔夜利息\库存费（Swap）
持仓超过了规定的交割周期时会产生的费用，可能是盈利可能是亏损。

### 认识MetaEditor
编写的源码文件是`.mq5`格式，编译后会生成`.ex`格式文件。

### 第一个MQL5程序
- C++语法，不要忘记分号。
- 编译完之后，按`F5`即可跳转到MT5软件并输出脚本运行结果。

### 注释
多行注释使用`/*`作为开始到`*/`结束，在这之间不能够嵌套。单行注释使用`//`作为开始到新的一行结束，可以被嵌套到多行注释之中。

单行注释快捷键：`ctrl`+`'`；取消注释快捷键：`ctrl`+`;`；更多可见“编辑” -> “高级”。

## 数据类型

### 数据类型和内存
- 数据类型：定义不同的数据类型向内存申请的空间大小不同，能够表示的数值范围也就不同。不同的数据类型有不同的处理速度，整型数据是最快的。双精度的数据处理需要特殊的协同处理器，然而，因为处理浮点型数据比较复杂， 所以它比处理整型数据慢一些。字符串是处理速度最慢的，因为它要存取动态内存。

- 变量名：表示指向申请的内存地址ID的标签别名，比如：a -> 0x001122（内存地址ID）。
- 数据：存到申请的内存中的内容。

![数据类型、变量名与数据](./imgs/DataMem.jpg)

### 变量命名规范
- 变量的名称不能使用系统保留的关键字；
- 变量名称只能由字母、数字和下划线`_`组成；
- 变量名称不能以数字作为开头；
- 变量名称区分大小写；
- 以下划线`_`开头的变量约定俗成作为私有变量。

变量命名：小写，单词之间用下划线`_`连接。

函数命名：驼峰命名法，单词首字母大写。

### 整型
| 类型 | 字节大小 | 最小值 | 最大值 | C++类比 |
| :-:  | :-:     | :-:   | :-:    | :-:    |
| char | 1       | -128  | 127    | char   |
| uchar | 1 | 0 | 255 | unsigned char, BYTE |
| bool | 1 | 0 (false) | 1 (true) | bool |
| short | 2 | -32768 | 32767 | short, wchar_t |
| ushort | 2 | 0 | 65535 | unsigned short, WORD |
| int | 4 | -2147483648 | 2147483647 | int |
| uint | 4 | 0 | 4294967295 | unsigned int, DWORD |
| color | 4 | -1 | 16777215 | int, COLORREF |
| long | 8 | -9223372036854775808 | 9223372036854775807 | __int64|
| ulong | 8 | 0 | 18446744073709551615 | unsigned __int64 |
| datetime | 8 | 0 (1970.01.01 0:00:00) | 32 535 244 799 (3000.12.31 23:59:59) | __time64_t |

### 布尔型
bool，占1个字节，只有0(false)和1(true)两个值。

### 浮点型
浮点型包括两种数据类型：`float`和`double`。`float`占4个字节，可表示7位有效数字；`double`占8个字节，可表示16位有效数字。

### 字符型
字符型包括两种数据类型：`char`和`uchar`，均占1个字节，用于表示单个字符。字符型应当使用单引号`''`括起来。

### 字符串型
字符串型指`string`数据类型，用于表示多个字符连接组成的字符串，MQL5中规定字符串的长度范围为0~2000个字符。字符串所占字节数为写出的字符总数+1，1是末尾自动添加的`\0`，长度为从第一个字符到第一个`\0`为止（不计`\0`）的字符数。字符串应当使用双引号`""`括起来，转义字符使用`\`。

### 日期时间类型
日期时间类型指`datetime`数据类型，占8个字节，用于表示日期时间，可表示的时间范围为1970.01.01 0:00:00 ~ 3000.12.31 23:59:59。可以按完整的日期+时间格式（`D'2023.1.2 21:15:50`）赋值，也可以只写一部分，例如：
- 只写日期：`D'2023.1.2'`，此时时间默认为`0:00:00`；
- 只写时间：`D'21:15:50'`，此时日期默认为当天日期；
- 写日期和小时：`D'2023.1.2 21'`，此时分钟和秒默认为`00`；
- 写日期、小时和分钟：`D'2023.1.2 21:15`，此时秒默认为`00`。

注意格式是`D` `+`**单引号**`''`括起来的日期时间。

### 颜色类型
颜色类型指`color`数据类型，占4个字节，用于表示颜色值（第一个字节忽略不计，其余三个字节表示红绿蓝），表示范围为（0~255, 0~255, 0~255）。颜色类型有多种赋值方式，例如：
- 十进制RGB：`C'128,128,128'`　　　　　　　　// 灰色
- 十六进制RGB：`C'0x00,0x00,0xFF'`　　　　　　　　// 蓝色
- 十进制整数：`16777215`　　　　　　　　// 白色
- 十六进制整数：`0xFFFFFF`　　　　　　　　// 白色
- 颜色名称：`clrRed`　　　　　　　　// 红色

### 枚举类型
枚举类型即`enum`数据类型，相当于常量列表，其格式为：
```
enum name of enumerable type
  {
   list of values
  };
```
例如：
```
enum intervals
   {
    month=1,
    quarter=3,
    halfyear=6,
    year=12,
   };
```

### 数据类型转换
各种数据类型之间可以转换，但需要注意，有的转换可能会导致数据丢失，比如`double`转`int`，因此这样的转换是不建议的。允许的转换如下：

![数据类型转换](./imgs/DataTypeTrans.png)

其中实线箭头表示不会丢失精度，虚线箭头表示会丢失精度。当然，各种数据类型都可以转换成`string`类型。

### 类型转换函数
MQL5提供了一些用来进行数据类型转换的函数，我们可以直接使用。某些函数除了进行数据类型转换外，还具有指定输出值小数点后的位数、指定输出时间格式等功能。
| 函数 | 功能 |
| :-: | :-:  |
| [`CharToString`](#CharToString-url) | 将字符型转换为字符串 |

<h4 id='CharToString-url'> CharToString </h4>
```
string CharToString(
  uchar char_code;
)
```


## 运算符

## 流程控制语句

## 数组

## 排序方法

## 函数

## 结构体

## 账户信息函数

## 货币对信息函数

## 交易操作函数